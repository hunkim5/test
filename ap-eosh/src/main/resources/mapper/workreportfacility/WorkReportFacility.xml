<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airpremia.eosh.report.workreport.facility.repository.WorkReportFacilityRepository">
    <select id="selectWorkReportFacilityPage" resultType="WorkReportFacilityPageDto">
        SELECT facility_seq
            ,work_facility_classification_enum
            ,title
            ,introduction_code
            ,introduction_facility_code
            ,product_name
            ,model_name
            ,model_number
            ,quantity
            ,product_manufacturer_name
            ,safety_inspection_dt
            ,safety_certification_bool
            ,autonomy_safety_check_report_bool
            ,safety_inspection_bool
            ,etc_bool
            ,movement_area_registration_no
            ,registration_dt
            ,expiration_dt
            ,first_time_inspection_dt
            ,product_manufacturer_phoneno
            ,product_manufacturer_email
            ,safety_inspection_expiration_dt
            ,new_introduction_location
            ,add_comment
            ,multiple_file_safetycertification_uuid
            ,multiple_file_safetyinspection_uuid
            ,multiple_file_autonomysafety_uuid
            ,approval_work_report_status_enum
            ,request_department
            ,storage_department_code
            ,report_no
            ,reject_reason
            ,insert_dtm
        FROM work_report_facility
        <where>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.reportNo)">
                AND report_no LIKE #{searchDto.reportNo}
            </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.workFacilityClassificationEnum)">
                AND work_facility_classification_enum LIKE #{searchDto.workFacilityClassificationEnum}
            </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.title)">
                AND title LIKE #{searchDto.title}
            </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.introductionFacilityCode)">
                AND introduction_facility_code LIKE #{searchDto.introductionFacilityCode}
            </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.productName)">
                AND product_name LIKE #{searchDto.productName}
            </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.modelName)">
                AND model_name LIKE #{searchDto.modelName}
            </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.approvalWorkReportStatusEnum)">
                AND approval_work_report_status_enum LIKE #{searchDto.approvalWorkReportStatusEnum}
            </if>
        </where>
        ORDER BY facility_seq DESC
    </select>

    <select id="selectWorkReportFacility" resultType="WorkReportFacilityDto">
        SELECT facility_seq
             ,work_facility_classification_enum
             ,title
             ,introduction_code
             ,introduction_facility_code
             ,product_name
             ,model_name
             ,model_number
             ,quantity
             ,product_manufacturer_name
             ,safety_inspection_dt
             ,safety_certification_bool
             ,autonomy_safety_check_report_bool
             ,safety_inspection_bool
             ,etc_bool
             ,movement_area_registration_no
             ,registration_dt
             ,expiration_dt
             ,first_time_inspection_dt
             ,product_manufacturer_phoneno
             ,product_manufacturer_email
             ,safety_inspection_expiration_dt
             ,new_introduction_location
             ,add_comment
             ,multiple_file_safetycertification_uuid
             ,multiple_file_safetyinspection_uuid
             ,multiple_file_autonomysafety_uuid
             ,approval_work_report_status_enum
             ,request_department
             ,storage_department_code
             ,report_no
             ,reject_reason
        FROM work_report_facility
        WHERE
            facility_seq = #{facilitySeq}
    </select>

    <insert id="insertWorkReportFacility" useGeneratedKeys="true" keyProperty="facilitySeq">
        INSERT INTO work_report_facility
            (work_facility_classification_enum
            ,title
            ,introduction_code
            ,introduction_facility_code
            ,product_name
            ,model_name
            ,model_number
            ,quantity
            ,product_manufacturer_name
            ,safety_inspection_dt
            ,safety_certification_bool
            ,autonomy_safety_check_report_bool
            ,safety_inspection_bool
            ,etc_bool
            ,movement_area_registration_no
            ,registration_dt
            ,expiration_dt
            ,first_time_inspection_dt
            ,product_manufacturer_phoneno
            ,product_manufacturer_email
            ,safety_inspection_expiration_dt
            ,new_introduction_location
            ,add_comment
            ,multiple_file_safetycertification_uuid
            ,multiple_file_safetyinspection_uuid
            ,multiple_file_autonomysafety_uuid
            ,approval_work_report_status_enum
            ,request_department
            ,storage_department_code
            ,report_no
            ,reject_reason
            ,insert_ip
            ,insert_user_id)
        VALUES
            (#{workFacilityClassificationEnum}
            ,#{title}
            ,#{introductionCode}
            ,#{introductionFacilityCode}
            ,#{productName}
            ,#{modelName}
            ,#{modelNumber}
            ,#{quantity}
            ,#{productManufacturerName}
            ,#{safetyInspectionDt}
            ,#{safetyCertificationBool}
            ,#{autonomySafetyCheckReportBool}
            ,#{safetyInspectionBool}
            ,#{etcBool}
            ,#{movementAreaRegistrationNo}
            ,#{registrationDt}
            ,#{expirationDt}
            ,#{firstTimeInspectionDt}
            ,#{productManufacturerPhoneno}
            ,#{productManufacturerEmail}
            ,#{safetyInspectionExpirationDt}
            ,#{newIntroductionLocation}
            ,#{addComment}
            ,#{multipleFileSafetycertificationUuid}
            ,#{multipleFileSafetyinspectionUuid}
            ,#{multipleFileAutonomysafetyUuid}
            ,#{approvalWorkReportStatusEnum}
            ,#{requestDepartment}
            ,#{storageDepartmentCode}
            ,#{reportNo}
            ,#{rejectReason}
            ,#{insertIp}
            ,#{insertUserId})
    </insert>

    <select id="selectFacilityReportCount" resultType="String">
        SELECT
            report_no
        FROM work_report_facility
        <where>
            AND report_no LIKE #{searchReportNumber}
        </where>
        ORDER BY report_no DESC
    </select>

    <update id="updateWorkReportFacility">
        UPDATE work_report_facility SET
        work_facility_classification_enum = #{updateDto.workFacilityClassificationEnum}
        ,title = #{updateDto.title}
        ,introduction_code = #{updateDto.introductionCode}
        ,introduction_facility_code = #{updateDto.introductionFacilityCode}
        ,product_name = #{updateDto.productName}
        ,model_name = #{updateDto.modelName}
        ,model_number = #{updateDto.modelNumber}
        ,quantity = #{updateDto.quantity}
        ,product_manufacturer_name = #{updateDto.productManufacturerName}
        ,safety_inspection_dt = #{updateDto.safetyInspectionDt}
        ,safety_certification_bool = #{updateDto.safetyCertificationBool}
        ,autonomy_safety_check_report_bool = #{updateDto.autonomySafetyCheckReportBool}
        ,safety_inspection_bool = #{updateDto.safetyInspectionBool}
        ,etc_bool = #{updateDto.etcBool}
        ,movement_area_registration_no = #{updateDto.movementAreaRegistrationNo}
        ,registration_dt = #{updateDto.registrationDt}
        ,expiration_dt = #{updateDto.expirationDt}
        ,first_time_inspection_dt = #{updateDto.firstTimeInspectionDt}
        ,product_manufacturer_phoneno = #{updateDto.productManufacturerPhoneno}
        ,product_manufacturer_email = #{updateDto.productManufacturerEmail}
        ,safety_inspection_expiration_dt = #{updateDto.safetyInspectionExpirationDt}
        ,new_introduction_location = #{updateDto.newIntroductionLocation}
        ,add_comment = #{updateDto.addComment}
        ,multiple_file_safetycertification_uuid = #{updateDto.multipleFileSafetycertificationUuid}
        ,multiple_file_safetyinspection_uuid = #{updateDto.multipleFileSafetyinspectionUuid}
        ,multiple_file_autonomysafety_uuid = #{updateDto.multipleFileAutonomysafetyUuid}
        ,approval_work_report_status_enum = #{updateDto.approvalWorkReportStatusEnum}
        ,request_department = #{updateDto.requestDepartment}
        ,storage_department_code = #{updateDto.storageDepartmentCode}
        ,report_no = #{updateDto.reportNo}
        ,reject_reason = #{updateDto.rejectReason}
        ,update_ip = #{updateDto.updateIp}
        ,update_user_id = #{updateDto.updateUserId}
        <where>
            AND facility_seq = #{facilitySeq}
        </where>
    </update>
    <delete id="deleteWorkReportFacility">
        DELETE
        FROM work_report_facility
        <where>
            AND facility_seq = #{facilitySeq}
        </where>
    </delete>
    <update id="updateWorkReportFacilityStatus">
        UPDATE work_report_facility SET
            approval_work_report_status_enum = #{updateDto.approvalWorkReportStatusEnum}
            ,first_time_inspection_dt = #{updateDto.firstTimeInspectionDt}
            ,registration_dt = #{updateDto.registrationDt}
            ,reject_reason = #{updateDto.rejectReason}
        WHERE
            facility_seq = #{facilitySeq}
    </update>
    <update id="updateQuantity">
        UPDATE work_report_facility SET
            quantity = #{quantity}
        WHERE
            facility_seq = #{facilitySeq}
    </update>
</mapper>
