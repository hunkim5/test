<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airpremia.eosh.report.workreport.workreportequipmentdisassembly.repository.WorkReportEquipmentDisassemblyRepository">
    <select id="selectWorkReportEquipmentDisassemblyPage" resultType="WorkReportEquipmentDisassemblyPageDto">
           SELECT work_report_equipment_disassembly_seq
           ,report_no
           ,subject
           ,protection_device_name
           ,disassembly_reason
           ,add_comment
           ,multiple_file_uuid
           ,approval_work_report_status_enum
           ,insert_dtm
        FROM work_report_equipment_disassembly
        <where>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.protectionDeviceName)">
                AND protection_device_name = #{searchDto.protectionDeviceName}
            </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.approvalWorkReportStatusEnum)">
                AND approval_work_report_status_enum = #{searchDto.approvalWorkReportStatusEnum}
            </if>
        </where>
    </select>

    <select id="selectWorkReportEquipmentDisassembly" resultType="WorkReportEquipmentDisassemblyDto">
           SELECT work_report_equipment_disassembly_seq
           ,report_no
           ,subject
           ,protection_device_name
           ,disassembly_reason
           ,add_comment
           ,multiple_file_uuid
           ,approval_work_report_status_enum
           ,reject_reason
        FROM work_report_equipment_disassembly
        WHERE
            work_report_equipment_disassembly_seq = #{workReportEquipmentDisassemblySeq}
    </select>

    <insert id="insertWorkReportEquipmentDisassembly" useGeneratedKeys="true" keyProperty="workReportEquipmentDisassemblySeq">
        INSERT INTO work_report_equipment_disassembly
        (report_no
        ,subject
        ,protection_device_name
        ,disassembly_reason
        ,add_comment
        ,multiple_file_uuid
        ,approval_work_report_status_enum
        ,insert_ip
        ,insert_user_id)
 VALUES
        (#{reportNo}
        ,#{subject}
        ,#{protectionDeviceName}
        ,#{disassemblyReason}
        ,#{addComment}
        ,#{multipleFileUuid}
        ,#{approvalWorkReportStatusEnum}
        ,#{insertIp}
        ,#{insertUserId})
    </insert>

    <update id="updateWorkReportEquipmentDisassembly">
        UPDATE work_report_equipment_disassembly SET
        report_no = #{reportNo}
        ,subject = #{subject}
        ,protection_device_name = #{protectionDeviceName}
        ,disassembly_reason = #{disassemblyReason}
        ,add_comment = #{addComment}
        ,multiple_file_uuid = #{multipleFileUuid}
        ,approval_work_report_status_enum = #{approvalWorkReportStatusEnum}
        ,update_ip = #{updateIp}
        ,update_user_id = #{updateUserId}
        <where>
            AND work_report_equipment_disassembly_seq = #{workReportEquipmentDisassemblySeq}
        </where>
    </update>
    <delete id="deleteWorkReportEquipmentDisassembly">
        DELETE
        FROM work_report_equipment_disassembly
        <where>
            work_report_equipment_disassembly_seq = #{workReportEquipmentDisassemblySeq}
        </where>
    </delete>
    <update id="updateWorkReportEquipmentDisassemblyStatus">
        UPDATE work_report_equipment_disassembly SET
            approval_work_report_status_enum = #{approvalWorkReportStatusEnum}
            ,reject_reason = #{rejectReason}
        <where>
            AND work_report_equipment_disassembly_seq = #{workReportEquipmentDisassemblySeq}
        </where>
    </update>
    <select id="selectEquipmentDisassemblyReportCount" resultType="String">
        SELECT
        report_no
        FROM work_report_equipment_disassembly
        <where>
            AND report_no LIKE #{searchReportNumber}
        </where>
        ORDER BY report_no DESC
    </select>
</mapper>
