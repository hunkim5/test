<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airpremia.eosh.report.workreport.workreportconstruction.repository.WorkReportConstructionRepository">
    <select id="selectWorkReportConstructionPage" resultType="WorkReportConstructionPageDto">
               SELECT work_report_construction_seq
                ,report_no
                ,work_report_subject
                ,work_construction_classification_enum
                ,work_expect_dt
                ,perform_company_name
                ,perform_incharge_phoneno
                ,source_address
                ,target_address
                ,maintenance_content
                ,incharge_user_id
                ,incharge_department_id
                ,approval_work_report_status_enum
                ,multiple_file_uuid
               ,insert_dtm
            FROM work_report_construction
            <where>
                <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.reportNo)">
                    AND report_no LIKE #{searchDto.reportNo}
                </if>
                <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.workConstructionClassificationEnum)">
                    AND work_construction_classification_enum = #{searchDto.workConstructionClassificationEnum}
                </if>
                <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.workReportSubject)">
                    AND work_report_subject LIKE #{searchDto.workReportSubject}
                </if>
                <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.sourceAddress)">
                    AND source_address LIKE #{searchDto.sourceAddress}
                </if>
                <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.targetAddress)">
                    AND target_address LIKE #{searchDto.targetAddress}
                </if>
                <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.workExpectDt)">
                    AND work_expect_dt = #{searchDto.workExpectDt}
                </if>
                <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.approvalWorkReportStatusEnum)">
                    AND approval_work_report_status_enum = #{searchDto.approvalWorkReportStatusEnum}
                </if>
            </where>
        </select>

        <select id="selectWorkReportConstruction" resultType="WorkReportConstructionDto">
               SELECT work_report_construction_seq
                ,report_no
               ,work_report_subject
               ,work_construction_classification_enum
               ,work_expect_dt
               ,perform_company_name
               ,perform_incharge_phoneno
               ,source_address
               ,target_address
               ,maintenance_content
               ,incharge_user_id
               ,incharge_department_id
               ,approval_work_report_status_enum
               ,multiple_file_uuid
               ,reject_reason
            FROM work_report_construction
            WHERE work_report_construction_seq = #{workReportConstructionSeq}
        </select>

        <select id="selectConstructionReportCount" resultType="String">
            SELECT
            report_no
            FROM work_report_construction
            <where>
                AND report_no LIKE #{searchReportNumber}
            </where>
            ORDER BY report_no DESC
        </select>

        <insert id="insertWorkReportConstruction" useGeneratedKeys="true" keyProperty="workReportConstructionSeq">
            INSERT INTO work_report_construction
            (report_no
            ,work_report_subject
            ,work_construction_classification_enum
            ,work_expect_dt
            ,perform_company_name
            ,perform_incharge_phoneno
            ,source_address
            ,target_address
            ,maintenance_content
            ,incharge_user_id
            ,incharge_department_id
            ,approval_work_report_status_enum
            ,multiple_file_uuid
            ,insert_ip
            ,insert_user_id
            ,insert_dtm)
     VALUES
            (#{reportNo}
            ,#{workReportSubject}
            ,#{workConstructionClassificationEnum}
            ,#{workExpectDt}
            ,#{performCompanyName}
            ,#{performInchargePhoneno}
            ,#{sourceAddress}
            ,#{targetAddress}
            ,#{maintenanceContent}
            ,#{inchargeUserId}
            ,#{inchargeDepartmentId}
            ,#{approvalWorkReportStatusEnum}
            ,#{multipleFileUuid}
            ,#{insertIp}
            ,#{insertUserId}
            ,CURRENT_TIMESTAMP(6))
        </insert>

        <update id="updateWorkReportConstruction">
            UPDATE work_report_construction SET
             work_report_subject = #{workReportSubject}
            ,work_construction_classification_enum = #{workConstructionClassificationEnum}
            ,work_expect_dt = #{workExpectDt}
            ,perform_company_name = #{performCompanyName}
            ,perform_incharge_phoneno = #{performInchargePhoneno}
            ,source_address = #{sourceAddress}
            ,target_address = #{targetAddress}
            ,maintenance_content = #{maintenanceContent}
            ,incharge_user_id = #{inchargeUserId}
            ,incharge_department_id = #{inchargeDepartmentId}
            ,approval_work_report_status_enum = #{approvalWorkReportStatusEnum}
            ,multiple_file_uuid = #{multipleFileUuid}
            ,update_ip = #{updateIp}
            ,update_user_id = #{updateUserId}
            ,update_dtm = CURRENT_TIMESTAMP(6)
            <where>
                AND work_report_construction_seq = #{workReportConstructionSeq}
            </where>
        </update>
        <delete id="deleteWorkReportConstruction">
            DELETE
            FROM work_report_construction
            <where>
                  AND work_report_construction_seq = #{workReportConstructionSeq};
            </where>
        </delete>
        <update id="updateWorkReportConstructionStatus">
            UPDATE work_report_construction SET
                approval_work_report_status_enum = #{approvalWorkReportStatusEnum}
                ,reject_reason = #{rejectReason}
            WHERE
                work_report_construction_seq = #{workReportConstructionSeq}
        </update>
</mapper>
