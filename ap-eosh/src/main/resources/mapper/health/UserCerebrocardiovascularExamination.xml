<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airpremia.eosh.personaldetail.health.repository.UserCerebrocardiovascularExaminationRepository">

    <select id="selectUserCerebrocardiovascularExaminationPage" resultType="UserCerebrocardiovascularExaminationPageDto">
           SELECT uce.user_seq
              , uce.standard_yyyy
              , uce.examination_status_enum
              , uce.examination_dt
              , uce.risk_group_classification_code
              , uce.examination_record_content
              , uce.multiple_file_uuid
              , usr.user_job_classification_classification_enum
              , usr.user_id
           FROM user_cerebrocardiovascular_examination uce
           JOIN `user` usr on uce.user_seq = usr.user_seq
           <where>
               <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.riskGroupClassificationCode)">
                   AND uce.risk_group_classification_code = #{searchDto.riskGroupClassificationCode}
               </if>
               <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.userJobClassificationClassificationEnum)">
                   AND usr.user_job_classification_classification_enum = #{searchDto.userJobClassificationClassificationEnum}
               </if>
               <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.userId)">
                   AND usr.user_id = #{searchDto.userId}
               </if>
           </where>
    </select>

    <select id="selectUserCerebrocardiovascularExamination" resultType="UserCerebrocardiovascularExaminationDto">
           SELECT user_seq
           ,standard_yyyy
           ,examination_status_enum
           ,examination_dt
           ,risk_group_classification_code
           ,examination_record_content
           ,multiple_file_uuid
        FROM user_cerebrocardiovascular_examination
        WHERE
            user_seq = #{userSeq}
        AND standard_yyyy = #{standardYyyy}
    </select>

    <insert id="insertUserCerebrocardiovascularExamination">
        INSERT INTO user_cerebrocardiovascular_examination
        (user_seq
        ,standard_yyyy
        ,examination_status_enum
        ,examination_dt
        ,risk_group_classification_code
        ,examination_record_content
        ,multiple_file_uuid
        ,insert_ip
        ,insert_user_id)
 VALUES
        (#{userSeq}
        ,#{standardYyyy}
        ,#{examinationStatusEnum}
        ,#{examinationDt}
        ,#{riskGroupClassificationCode}
        ,#{examinationRecordContent}
        ,#{multipleFileUuid}
        ,#{insertIp}
        ,#{insertUserId})
    </insert>

    <update id="updateUserCerebrocardiovascularExamination">
        UPDATE user_cerebrocardiovascular_examination
        SET
        examination_status_enum = #{examinationStatusEnum}
        ,examination_dt = #{examinationDt}
        ,risk_group_classification_code = #{riskGroupClassificationCode}
        ,examination_record_content = #{examinationRecordContent}
        ,multiple_file_uuid = #{multipleFileUuid}
        ,update_ip = #{updateIp}
        ,update_user_id = #{updateUserId}
        <where>
            user_seq = #{userSeq}
        AND standard_yyyy = #{standardYyyy}
        </where>
    </update>
    <update id="updateUserSex">
        UPDATE user
        SET sex=#{sex}
        <where>
            user_seq = #{userSeq}
        </where>
    </update>

    <delete id="deleteUserCerebrocardiovascularExamination">
            DELETE
            FROM user_cerebrocardiovascular_examination
            WHERE user_seq=#{userSeq}
            AND standard_yyyy = #{standardYyyy}
    </delete>

    <select id="selectCerebrocardiovascularExaminationInfo" resultType="UserCerebrocardiovascularExaminationDto">
         SELECT
             risk_group_classification_code
         FROM user_cerebrocardiovascular_examination
         WHERE user_seq = #{userSeq} and standard_yyyy = #{standardYyyy}
    </select>
</mapper>
