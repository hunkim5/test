<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airpremia.eosh.personaldetail.health.repository.HealthRepository">

    <select id="selectHealthPage" resultType="HealthPageDto">
        SELECT
            usr.user_id
            ,une.user_seq
            ,une.standard_yyyy
            ,une.dept_cd
            ,une.post_nm
            ,une.normal_examination_code
            ,une.dept_nm
        FROM
            user_normal_examination une
            JOIN user usr on usr.user_seq = une.user_seq
        <where>
             <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(standardYyyy)">
                 AND une.standard_yyyy = #{standardYyyy}
             </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(deptCd)">
                AND une.dept_cd = #{deptCd}
            </if>
            <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(normalExaminationCode)">
                AND une.normal_examination_code = #{normalExaminationCode}
            </if>
        </where>
    </select>
    <select id="selectRealTimePublicNormalExamination" resultType="RealTimePublicNormalExaminationDto">
           SELECT birth_dt_name
           ,name
           ,birth_dt
           ,user_job_classificationclassification_enum
           ,stomach_cancer_bool_code
           ,oral_exam_bool_code
           ,breast_cancer_bool_code
           ,colon_cancer_bool_code
           ,cervical_cancer_bool_code
        FROM real_time_public_normal_examination
        WHERE
            birth_dt_name = #{birthDtName}
    </select>
    <delete id="deleteRealTimePublicNormalExamination">
        DELETE FROM real_time_public_normal_examination
    </delete>

    <insert id="insertRealTimePublicNormalExamination">
            INSERT INTO real_time_public_normal_examination
            (birth_dt_name
            ,name
            ,birth_dt
            ,user_job_classificationclassification_enum
            ,stomach_cancer_bool_code
            ,oral_exam_bool_code
            ,breast_cancer_bool_code
            ,colon_cancer_bool_code
            ,cervical_cancer_bool_code
            )
     VALUES
            (#{birthDtName}
            ,#{name}
            ,#{birthDtString}
            ,#{userJobClassificationclassificationEnum}
            ,#{stomachCancerBoolCode}
            ,#{oralExamBoolCode}
            ,#{breastCancerBoolCode}
            ,#{colonCancerBoolCode}
            ,#{cervicalCancerBoolCode}
            )
     </insert>

    <insert id="insertUserNormalExamination">
        INSERT INTO user_normal_examination
            (user_seq
            ,standard_yyyy
            ,examination_status_enum
            ,examination_dt
            ,oral_exam_bool_code
            ,stomach_cancer_bool_code
            ,breast_cancer_bool_code
            ,colon_cancer_bool_code
            ,cervical_cancer_bool_code
            ,multiple_file_uuid
            ,normal_examination_code
            ,dept_cd
            ,dept_nm
            ,post_nm
            ,remark
            ,insert_user_id
            ,insert_ip
            ,insert_dtm
           )
        VALUES
            (#{userSeq}
            ,#{standardYyyy}
            ,#{examinationStatusEnum}
            ,#{examinationDt}
            ,#{oralExamBoolCode}
            ,#{stomachCancerBoolCode}
            ,#{breastCancerBoolCode}
            ,#{colonCancerBoolCode}
            ,#{cervicalCancerBoolCode}
            ,#{multipleFileUuid}
            ,#{normalExaminationCode}
            ,#{deptCd}
            ,#{deptNm}
            ,#{postNm}
            ,#{remark}
            ,#{insertUserId}
            ,#{insertIp}
            ,#{insertDtm}
           )
    </insert>

    <insert id="insertRealTimeUserNormalExamination">
        INSERT INTO user_normal_examination
        (user_seq
        ,standard_yyyy
        ,examination_status_enum
        ,examination_dt
        ,noraml_examination_code
        ,oral_exam_bool_code
        ,stomach_cancer_bool_code
        ,breast_cancer_bool_code
        ,colon_cancer_bool_code
        ,cervical_cancer_bool_code
        ,multiple_file_uuid
        ,dept_cd
        ,dept_nm
        ,post_nm
       )
    VALUES
        (#{userSeq}
        ,#{standardYyyy}
        ,#{examinationStatusEnum}
        ,#{examinationDt}
        ,#{normalExaminationCode}
        ,#{oralExamBoolCode}
        ,#{stomachCancerBoolCode}
        ,#{breastCancerBoolCode}
        ,#{colonCancerBoolCode}
        ,#{cervicalCancerBoolCode}
        ,#{multipleFileUuid}
        ,#{dept_cd}
        ,#{dept_nm}
        ,#{post_nm}
       )
    </insert>

    <update id="updateUserNormalExamination">
             UPDATE user_normal_examination
                SET
                examination_status_enum = #{examinationStatusEnum}
                ,examination_dt = #{examinationDt}
                ,oral_exam_bool_code = #{oralExamBoolCode}
                ,stomach_cancer_bool_code = #{stomachCancerBoolCode}
                ,breast_cancer_bool_code = #{breastCancerBoolCode}
                ,colon_cancer_bool_code = #{colonCancerBoolCode}
                ,cervical_cancer_bool_code = #{cervicalCancerBoolCode}
                ,normal_examination_code = #{normalExaminationCode}
                ,multiple_file_uuid = #{multipleFileUuid}
                ,dept_cd = #{deptCd}
                ,dept_nm = #{deptNm}
                ,post_nm = #{postNm}
                ,remark = #{remark}
                <where>
                    user_seq = #{userSeq}
                AND standard_yyyy = #{standardYyyy}
                </where>
    </update>
    <update id="updateRealTimeUserNormalExamination">
        UPDATE user_normal_examination
        SET
        examination_status_enum = #{examinationStatusEnum}
        ,examination_dt = #{examinationDt}
        ,oral_exam_bool_code = #{oralExamBoolCode}
        ,stomach_cancer_bool_code = #{stomachCancerBoolCode}
        ,breast_cancer_bool_code = #{breastCancerBoolCode}
        ,colon_cancer_bool_code = #{colonCancerBoolCode}
        ,cervical_cancer_bool_code = #{cervicalCancerBoolCode}
        ,multiple_file_uuid = #{multipleFileUuid}
        ,dept_cd = #{deptCd}
        ,dept_nm = #{deptNm}
        ,post_nm = #{postNm}
        <where>
            user_seq = #{userSeq}
        AND standard_yyyy = #{standardYyyy}
        </where>
    </update>
    <select id="selectUserNormalExaminationCheck" resultType="String">
        SELECT user_seq
        FROM user_normal_examination
        WHERE user_seq=#{userSeq}
          AND standard_yyyy = #{standardYyyy}
    </select>

    <select id="selectUserNormalExaminationPage" resultType="UserNormalExaminationPageDto">
           SELECT une.user_seq
              ,une.standard_yyyy
              ,une.examination_status_enum
              ,une.examination_dt
              ,une.normal_examination_code
              ,une.oral_exam_bool_code
              ,une.stomach_cancer_bool_code
              ,une.breast_cancer_bool_code
              ,une.colon_cancer_bool_code
              ,une.cervical_cancer_bool_code
              ,une.multiple_file_uuid
              ,usr.user_job_classification_classification_enum
              ,usr.user_id
           FROM user_normal_examination une
           JOIN user usr ON une.user_seq = usr.user_seq
           <where>
               <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.normalExaminationCode)">
                   AND une.normal_examination_code = #{searchDto.normalExaminationCode}
               </if>
               <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.userJobClassificationClassificationEnum)">
                   AND usr.user_job_classification_classification_enum = #{searchDto.userJobClassificationClassificationEnum}
               </if>
               <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.userId)">
                   AND usr.user_id = #{searchDto.userId}
               </if>
           </where>
    </select>

    <select id="selectUserNormalExamination" resultType="UserNormalExaminationDto">
           SELECT une.user_seq
           ,une.standard_yyyy
           ,une.examination_status_enum
           ,une.examination_dt
           ,une.oral_exam_bool_code
           ,une.stomach_cancer_bool_code
           ,une.breast_cancer_bool_code
           ,une.colon_cancer_bool_code
           ,une.cervical_cancer_bool_code
           ,une.cervical_cancer_bool_code
           ,une.normal_examination_code
           ,une.multiple_file_uuid
           ,une.remark
           ,usr.user_id
        FROM user_normal_examination une
        JOIN user usr ON une.user_seq = usr.user_seq
        WHERE
            une.user_seq = #{userSeq}
        AND standard_yyyy = #{standardYyyy}
    </select>

        <delete id="deleteUserNormalExamination">
            DELETE
            FROM user_normal_examination
            WHERE user_seq=#{userSeq}
            AND standard_yyyy = #{standardYyyy}
        </delete>

        <select id="selectUserSeq" resultType="Long">
            select
                user_seq
            FROM user usr
            where user_id = #{userId}
        </select>

        <update id="updateUserSex">
            UPDATE user
            SET sex=#{sex}
            <where>
                user_seq = #{userSeq}
            </where>
        </update>

        <select id="selectHealthCheckFirstDetailPage" resultType="healthCheckDetailFirstDto">
           SELECT
             une.user_seq,
             une.standard_yyyy,
             une.examination_status_enum,
             une.normal_examination_code,
             une.oral_exam_bool_code,
             une.stomach_cancer_bool_code,
             une.breast_cancer_bool_code,
             une.colon_cancer_bool_code,
             une.cervical_cancer_bool_code,
             une.multiple_file_uuid,
             usp.special_exam_comment,
             usp.examination_result_content,
             usp.external_examination_record_content,
             usp.multiple_file_uuid,
             uwss.standard_yyyy,
             uwss.average_score,
             usr.user_id
           FROM user_normal_examination une
             JOIN user usr ON une.user_seq = usr.user_seq
             LEFT JOIN user_special_examination usp ON une.user_seq = usp.user_seq
             LEFT JOIN user_work_stress_survey uwss ON une.user_seq = uwss.user_seq
           WHERE
             usr.user_id = #{userId}
             AND une.standard_yyyy = #{standardYyyy}
           GROUP BY
             usr.user_id;
    </select>

    <select id="selectHealthCheckSecondDetailPage" resultType="healthCheckDetailSecondDto">
        SELECT
          ucre.user_seq,
          ucre.standard_yyyy,
          ucre.examination_status_enum,
          ucre.examination_dt,
          ucre.white_blood_cell_comment,
          ucre.platelet_comment,
          ucre.hemoglobin_comment,
          ucre.examination_dt,
          ucre.reexamination_comment,
          ucre.first_special_note,
          ucre.multiple_file_uuid,
          uce.risk_group_classification_code,
          hdl.health_dt,
          hdl.symptoms_content,
          hdl.etc_content,
          hdl.use_product_content,
          hdl.use_quantity_comment,
          usr.user_job_classification_classification_enum,
          usr.user_id
        FROM
          user_cosmic_radiation_examination ucre
          JOIN user usr ON ucre.user_seq = usr.user_seq
          LEFT JOIN user_cerebrocardiovascular_examination uce ON ucre.user_seq = uce.user_seq
          LEFT JOIN health_daily_log hdl ON usr.user_id = hdl.user_id
        WHERE ucre.standard_yyyy = #{standardYyyy}
           AND usr.user_id = #{userId}
           GROUP BY usr.user_id
    </select>
</mapper>
