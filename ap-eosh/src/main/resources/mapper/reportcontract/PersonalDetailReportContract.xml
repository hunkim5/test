<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.airpremia.eosh.personaldetail.reportcontract.repository.PersonalDetailReportContractRepository">
    <select id="selectReportContractPage" resultType="PersonalDetailReportContractPageDto">
           SELECT
             contract_seq
           , contract_company_name
           , contract_company_incharge_name
           , contract_company_contact
           , contract_company_email
           , company_grade_enum
           , safety_action_target_bool
           , safety_health_consultative_group_bool
           , safety_health_check_bool
           , evaluation_target_bool
           , contract_incharge_department_name
           , contract_incharge_department_code
           , contract_incharge_id
           , contract_incharge_name
           , approval_work_report_status_enum
        FROM report_contract
        <where>
            AND approval_work_report_status_enum = 'APPROVAL'
        <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.companyGradeEnum)">
            AND company_grade_enum = #{searchDto.companyGradeEnum}
        </if>
         <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.contractInchargeId)">
             AND contract_incharge_id = #{searchDto.contractInchargeId}
         </if>
         <if test="@com.airpremia.esmsfos.core.MybatisUtils@isNotEmpty(searchDto.contractInchargeDepartmentCode)">
             AND contract_incharge_department_code = #{searchDto.contractInchargeDepartmentCode}
        </if>
        </where>
    </select>

    <select id="selectReportContract" resultType="PersonalDetailReportContractDto">
        SELECT
             contract_seq
            , contract_company_name
            , contract_company_incharge_name
            , contract_company_contact
            , contract_company_email
            , company_grade_enum
            , top_company_one_order
            , top_company_two_order
            , top_company_three_order
            , safety_action_target_bool
            , safety_health_consultative_group_bool
            , safety_health_check_bool
            , evaluation_target_bool
            , contract_incharge_department_code
            , contract_incharge_department_name
            , contract_incharge_id
            , contract_incharge_name
            , report_no
            , attach_multiple_file_uuid
        FROM report_contract
        <where>
            AND contract_seq = #{contractSeq}
        </where>
    </select>

    <select id="selectContractCompany" resultType="PersonalDetailContractCompanyDto">
        SELECT
            contract_company_name
            , contract_seq
        FROM report_contract
        <where>
            AND company_grade_enum = #{companyGradeEnum}
        </where>
    </select>

    <update id="updateReportContract">
        UPDATE report_contract
        SET
            contract_company_incharge_name = #{contractCompanyInchargeName}
            ,contract_company_contact = #{contractCompanyContact}
            ,contract_company_email = #{contractCompanyEmail}
            ,company_grade_enum = #{companyGradeEnum}
            ,safety_action_target_bool = #{safetyActionTargetBool}
            ,safety_health_consultative_group_bool = #{safetyHealthConsultativeGroupBool}
            ,safety_health_check_bool = #{safetyHealthCheckBool}
            ,evaluation_target_bool = #{evaluationTargetBool}
            ,top_company_one_order = #{topCompanyOneOrder}
            ,top_company_two_order = #{topCompanyTwoOrder}
            ,top_company_three_order = #{topCompanyThreeOrder}
        <where>
            AND contract_seq = #{contractSeq}
        </where>
    </update>
</mapper>
